function loadMultiCategoryDT(n,e){$("#hlprfrm").ajaxSubmit({url:EditorMod.URL.DTBL_GET_MULTI_TMPLT,clearForm:!1,dataType:"json",beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:n}),t.push({name:"datafile",value:DATAFILE}),t.push({name:"displabels",value:e})},success:function(t){for(var o=n.split("+"),i=0;i<o.length;i++){$("#dt_rslts_combo").append('<div id="dtbl_'+(i+1)+'" class="atomic_dt_container" style="margin-bottom: 10px; padding: 8px; border-style:solid; border-width:1px; border-color:#c1d6c1;"></div>');var e=o[i],r="dtbl_"+(i+1);setupCategoryDT(e,t.html[e],t.ctgry_dict[e],r)}return postDTloadSetup(),!1}})}function loadCategoryDT(e,r,i,n){$("#hlprfrm").ajaxSubmit({url:EditorMod.URL.DTBL_GET_TMPLT,clearForm:!1,dataType:"json",beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:e}),t.push({name:"datafile",value:DATAFILE}),t.push({name:"displabel",value:r})},success:function(t){var o=setupCategoryDT(e,t.html,t.ctgry_dict,i);return 1==n&&postDTloadSetup(),o}})}function setupCategoryDT(c,t,o,r){if($("#"+r).html(t),initUIcifCtgry(c),o){var i=new Category;i.loadFromJson(o),void 0!==EditorMod.CtgryConfig[c]&&(void 0!==EditorMod.CtgryConfig[c].bAddingNewRow&&(i.bAddingNewRow=EditorMod.CtgryConfig[c].bAddingNewRow),void 0!==EditorMod.CtgryConfig[c].originalTotalRows&&0<=EditorMod.CtgryConfig[c].originalTotalRows&&(i.originalTotalRows=EditorMod.CtgryConfig[c].originalTotalRows,i.addedRows=EditorMod.CtgryConfig[c].addedRows,i.addedRowIds=EditorMod.CtgryConfig[c].addedRowIds,i.deletedRows=EditorMod.CtgryConfig[c].deletedRows,i.addingRowHwm=EditorMod.CtgryConfig[c].addingRowHwm)),i.presorted_cols=[];var e,u,n,d,a=i.getSortAscColIdx();0<=a&&(i.presorted_cols=[[a,"asc"]]),EditorMod.CtgryConfig[c]=i,e=EditorMod.CtgryConfig[c].getColDisplOrder(),u=EditorMod.CtgryConfig[c].getHiddenColumns(),n=EditorMod.CtgryConfig[c].getPrimaryKey();sServerMethod="POST",d=$("#"+c+"_tbl").dataTable({sDom:'ZRC<"categorynamelabel_'+c+' fltlft"><"hdrhelptxt fltlft"><"fltrgt"f><"tgglshwallcols_'+c+' fltrgt"><"trnspsvw_'+c+' fltrgt"><"chck_mndtry_itms_'+c+' fltrgt"><"pulltitle_'+c+' fltrgt"><"chck_dict_vltns_'+c+' fltrgt"><"undobtns_'+c+' fltrgt">rtip',oLanguage:{sSearch:"Search all columns:"},bSortCellsTop:!0,bProcessing:!0,bServerSide:!0,sAjaxSource:EditorMod.URL.DTBL_AJAX_LOAD,sServerMethod:sServerMethod,fnServerParams:function(t){t.push({name:"cifctgry",value:c}),t.push({name:"sessionid",value:SESSION_ID}),t.push({name:"datafile",value:DATAFILE}),t.push({name:"filesource",value:FILE_SOURCE})},sScrollX:"100%",bScrollCollapse:!0,iDisplayLength:getDisplayLength(c),bPaginate:!0,sPaginationType:"full_numbers",bLengthChange:!1,bFilter:!0,bSort:getSortFlag(c),bInfo:!0,bAutoWidth:!0,fnInitComplete:function(t,o){EditorMod.CtgryConfig[c].getNumCols();if(null==EditorMod.CtgryConfig[c].originalTotalRows&&(EditorMod.CtgryConfig[c].originalTotalRows=t.fnRecordsTotal(),EditorMod.CtgryConfig[c].addingRowHwm=EditorMod.CtgryConfig[c].originalTotalRows),0<=["citation","struct"].indexOf(c)){var i="citation"==c?"struct":"citation";$(".pulltitle_"+c).html('<input id="pulltitle-'+c+'" name="pulltitle-'+c+'" value="Copy Title from &quot;'+i+'&quot;" title="Pull Title from &quot;'+i+'&quot;" class="fltlft pulltitle" type="button" style="margin-top: 8px; margin-right: 20px; font-size: .8em;" />'),$("#pulltitle-"+c).button()}$(".undobtns_"+c).html('<input id="undototal-'+c+'" name="undototal-'+c+'" value="Undo (Reset)" title="Undo (Reset)" class="fltlft displaynone undo undototal" type="button" style="margin-top: 8px; margin-right: 8px; font-size: .8em;" /><input id="undoincrmntl-'+c+'" name="undoincrmntl-'+c+'" value="Undo (Incremental)" title="Undo (Incremental)" class="fltlft displaynone undo undoincrmntl" type="button" style="margin-top: 8px; margin-right: 20px; font-size: .8em;" />'),$(".undogrp").html(""),u.length&&($(".tgglshwallcols_"+c).html('<input id="toggleshowallcols-'+c+'" name="toggleshowallcols-'+c+'" value="Show All Fields" class="fltlft toggleshowallcols" type="button" style="margin-top: 8px; margin-right: 20px; font-size: .8em;" />'),$("#toggleshowallcols-"+c).button()),"editorconfig"!=EditorMod.context&&($(".trnspsvw_"+c).html('<input id="transposevw-'+c+'" name="transposevw-'+c+'" value="Transpose View" class="fltlft transposevw" type="button" style="margin-top: 8px; margin-right: 20px; font-size: .8em;" />'),$("#transposevw-"+c).button());d.fnTransposeState(!1);d.fnTranspose(!1),"editorconfig"!=EditorMod.context&&($(".chck_mndtry_itms_"+c).html('<input id="check_mandatory_items-'+c+'" name="check_mandatory_items-'+c+'" value="Check Mandatory Items" class="fltlft check_mandatory_items" type="button" style="margin-top: 8px; margin-right: 20px; font-size: .8em;" />'),$("#check_mandatory_items-"+c).button()),$("."+c+"_row_action").button();var e="";"pdbx_display_view_category_info"==c&&(e=' id="help_pdbx_display_view_category_info" title="title" '),"pdbx_display_view_item_info"==c&&(e=' id="help_pdbx_display_view_item_info" title="title" '),$(".categorynamelabel_"+c).html("<h3>Category: <span "+e+'><a href="https://mmcif.wwpdb.org/dictionaries/mmcif_pdbx_v5_next.dic/Categories/'+c+'.html" target="_blank" >'+c+"</a></span></h3>"),d.width("100%"),d.fnAdjustColumnSizing(),$(window).resize(function(){d.fnAdjustColumnSizing(),d.fnTransposeState()&&(d.width("100%"),$("#"+c+"_tbl_wrapper .dataTables_scrollHead").hide())}),(EditorMod.CtgryConfig[c].originalTotalRows>EditorMod.iSrchHeadersThrshld||"citation_author"==c)&&($("#"+r+" tr.srch_hdrs").show(),d.fnDraw(),d.fnAdjustColumnSizing())},fnDrawCallback:function(){EditorMod.CtgryConfig[c].iCnt_DrawBackCalledOnCurrentTbl+=1,ctgryIsReadOnly(c)||applyJeditable(c,d),applySearchHeaderFunctions(r,c,d),1<Math.ceil(this.fnSettings().fnRecordsDisplay()/this.fnSettings()._iDisplayLength)?($("#"+r+" .dataTables_paginate").css("display","block"),$("#"+r+" .dataTables_length").css("display","block"),$("#"+r+" .dataTables_filter").css("display","block")):($("#"+r+" .dataTables_paginate").css("display","none"),$("#"+r+" .dataTables_length").css("display","none"),"editorconfig"!=EditorMod.context&&$("#"+r+" .dataTables_filter").css("display","none"));var t="_tbl";if(d.fnTransposeState()?($("#"+c+"_tbl_wrapper input.search_init").parent().hide(),$("#"+c+"_record_actions").hide(),t="_tbl_transpose"):(EditorMod.CtgryConfig[c].unitCrdnlty||$("#"+c+"_record_actions").show(),$("#"+c+"_tbl_wrapper input.search_init").parent().show()),void 0!==EditorMod.currentMndtryViolations[c]&&0<EditorMod.currentMndtryViolations[c].length)for(var o=0;o<EditorMod.currentMndtryViolations[c].length;o++)$("#"+c+t).find('td[true_row_idx="'+EditorMod.currentMndtryViolations[c][o][0]+'"][true_col_idx="'+EditorMod.currentMndtryViolations[c][o][1]+'"]').addClass("mndtry_missing");if(void 0!==EditorMod.currentDictViolations[c]&&0<EditorMod.currentDictViolations[c].length)for(o=0;o<EditorMod.currentDictViolations[c].length;o++)$("#"+c+t).find('td[true_row_idx="'+EditorMod.currentDictViolations[c][o][0]+'"][true_col_idx="'+EditorMod.currentDictViolations[c][o][1]+'"]').addClass("dict_violation"),void 0!==EditorMod.currentDictViolations[c].violtn_msgs&&$("#"+c+t).find('td[true_row_idx="'+EditorMod.currentDictViolations[c][o][0]+'"][true_col_idx="'+EditorMod.currentDictViolations[c][o][1]+'"]').prop("title",EditorMod.currentDictViolations[c].violtn_msgs[o]);$("td.dict_violation").tooltip({show:{effect:"slideDown",delay:250},open:function(t,o){EditorMod.dictViolationsTooltip=!0}}),$("th.cifitemhdr").tooltip({show:{delay:150}}),"pdbx_display_view_category_info"==c&&$("#help_pdbx_display_view_category_info").tooltip({content:function(){return $("#pdbx_display_view_category_info_help").html()},position:{my:"left top-50",at:"right+30 top"},open:function(t,o){o.tooltip.css("max-width","1200px")}}),"pdbx_display_view_item_info"==c&&$("#help_pdbx_display_view_item_info").tooltip({content:function(){return $("#pdbx_display_view_item_info_help").html()},position:{my:"left top-50",at:"right+30 top"},open:function(t,o){o.tooltip.css("max-width","1200px")}})},oColReorder:{aiOrder:e,iFixedColumns:EditorMod.CtgryConfig[c].getNumCols()},aaSorting:EditorMod.CtgryConfig[c].getPreSortedColumns(),aoColumns:EditorMod.CtgryConfig[c].getDataTblaoColumns(),aoColumnDefs:[{aTargets:n,fnCreatedCell:function(t,o,i,e,r){var n=$(t),d=getTrueColIdx_DataTable(EditorMod.CtgryConfig[c],r),a=$(this).hasClass("trnspsd_tbl"),s=getTrueRowIdx_DataTable(t,e);if(!a){var l=!1;0<=["cell","pdbx_refine_tls_group","struct_ncs_ens","struct_ncs_dom","struct_ncs_dom_lim","struct_ncs_dom_lim","refine_ls_restr_ncs"].indexOf(c)&&0<=u.indexOf(parseInt(d))&&(l=!0),n.addClass("prmry_key"),applyReadOnlyProtection(c,n,d,l),applyMandatoryHighlight(c,n,d)}a&&(n.addClass("trnspsd"),-1<EditorMod.CtgryConfig[c].getPrimaryKey().indexOf(parseInt(s))&&n.addClass("prmry_key")),applyNewRecordAttrib(c,n,s,a),n.attr("true_col_idx",d),n.attr("true_row_idx",s)}},{aTargets:u,bVisible:!1,fnCreatedCell:function(t,o,i,e,r){var n=$(t),d=getTrueColIdx_DataTable(EditorMod.CtgryConfig[c],r),a=$(this).hasClass("trnspsd_tbl"),s=getTrueRowIdx_DataTable(t,e),l=!1;0<=["cell","pdbx_refine_tls_group","struct_ncs_ens","struct_ncs_dom","struct_ncs_dom_lim","struct_ncs_dom_lim","refine_ls_restr_ncs"].indexOf(c)&&(l=!0),a||(applyReadOnlyProtection(c,n,d,l),applyMandatoryHighlight(c,n,d)),a&&n.addClass("trnspsd"),applyNewRecordAttrib(c,n,s,a),n.attr("true_col_idx",d),n.attr("true_row_idx",s)}},{aTargets:["_all"],fnCreatedCell:function(t,o,i,e,r){var n=$(t),d=getTrueColIdx_DataTable(EditorMod.CtgryConfig[c],r),a=$(this).hasClass("trnspsd_tbl"),s=getTrueRowIdx_DataTable(t,e);0<d&&d<4&&n.addClass("favorite"),n.attr("true_col_idx",d),n.attr("true_row_idx",s),a||(applyReadOnlyProtection(c,n,d,!1),applyMandatoryHighlight(c,n,d)),applyNewRecordAttrib(c,n,s,a),a?(n.addClass("trnspsd"),vldtColIdx=s,vldtRowIdx=r-1):(vldtColIdx=r,vldtRowIdx=s),EditorMod.CtgryConfig[c].getVldtFlags(vldtColIdx,vldtRowIdx)&&n.addClass("vldt_flg").addClass(String(EditorMod.CtgryConfig[c].getVldtFlags(vldtColIdx,vldtRowIdx)))}}]}),EditorMod.oDataTable=d}return initBookKeepingCifCtgry(c),!1}function postDTloadSetup(){initUIglobalPostDTload(),createInitRollbackPoint()}function initBookKeepingGlobal(){EditorMod.currentCtgryNms=[],EditorMod.editActnIndx=0,EditorMod.deleteRowActns=[],EditorMod.addRowActns=[]}function initUIglobalPreDTload(){initJqueryUiComponents(),"ELECTRON MICROSCOPY"==EditorMod.expmethod?($("#toggle_em_view").button().show(),$("#em_view_label").show()):($("#toggle_em_view").hide(),$("#em_view_label").hide()),$("#context_menu").menu(),$("#context_menu_content").show(),$("#check_mandatory_items-all").show(),$("#check_dict_violations-all").show(),"editorconfig"==EditorMod.context?$("#help_editor_ui_admin").tooltip({content:function(){return $("#helpcontent").html()},position:{my:"right-1000 top",at:"left top-135"},open:function(t,o){o.tooltip.css("max-width","1200px")}}):$("#global_check_menu").menu().show()}function resetDTrsltsArea(){$("#dt_rslts_combo").html(""),$("#dt_rslts_single").html("").hide(),$("#dt_rslts_combo").show()}function initUIglobalPostDTload(){$(".undo").hide(),"editorconfig"!=EditorMod.context&&(showCheckViolButtons(),$("#transpose_vw_all").show(),toggleTransposeAllBtn()),$("#colorlegend").show()}function initJqueryUiComponents(){$("#other-value-form").dialog({autoOpen:!1,height:300,width:350,modal:!0,buttons:{Submit:function(t){var o=!0,i=$("#othervalue").val();if(0==i.length&&(o=!1),!o)return alert("Cannot submit an empty string."),!1;var e=$("<option />").attr("value",i).text(i).prop("selected",!0);$("#"+EditorMod.otherValInputId).append(e),EditorMod.bMultiSlctType?$("#"+EditorMod.otherValInputId).children().each(function(){-1!=EditorMod.selectedVals.indexOf($(this).html())&&$(this).prop("selected",!0),-1!="Other".indexOf($(this).html())&&$(this).prop("selected",!1)}):$("#"+EditorMod.otherValInputId).val(i).submit(),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},close:function(){}}),$("#insert_row").dialog({autoOpen:!1,height:"editorconfig"==EditorMod.context?370:250,width:350,modal:!0,buttons:{OK:function(){var t=new Array;$("#insert_row :checkbox:checked").each(function(){value=$(this).val(),t.push(value)});var o=$('select[name="insert_row_quantity"]').val();insertRows(EditorMod.currentRowSlctd_CtgryNm,EditorMod.currentRowSlctd,t,o),$(this).dialog("close")},Cancel:function(){$(this).dialog("close"),$("#context_menu").hide()}},close:function(){}}),$("#delete_row").dialog({autoOpen:!1,height:"editorconfig"==EditorMod.context?300:275,width:350,modal:!0,buttons:{OK:function(){var t=$('select[name="delete_row_quantity"]').val();deleteRows(EditorMod.currentRowSlctd_CtgryNm,EditorMod.currentRowSlctd,t),$(this).dialog("close")},Cancel:function(){$(this).dialog("close"),$("#context_menu").hide()}},close:function(){}}),$("#savedone").button().tooltip(),$("#abort").button().tooltip(),$("#check_mandatory_items-all").button().hide(),$("#check_dict_violations-all").button().hide(),$("#transpose_vw_all").button().hide()}function initSkipCalcControls(t){0<=["annotation","summaryreport","em","nmr"].indexOf(EditorMod.context)&&($("#skip_btns_grp").show(),"struct_conn+struct_mon_prot_cis"==t?($("#skip_site").hide(),$("#skip_solventpos").hide(),$(".skip_scndry_strctr").hide(),checkSkipCalc("link"),$("#skip_link").show().button()):"struct_site+struct_site_gen"==t?($("#skip_link").hide(),$("#skip_solventpos").hide(),$(".skip_scndry_strctr").hide(),checkSkipCalc("site"),$("#skip_site").show().button()):"pdbx_distant_solvent_atoms+pdbx_solvent_atom_site_mapping"==t?($("#skip_link").hide(),$("#skip_site").hide(),$(".skip_scndry_strctr").hide(),checkSkipCalc("solventpos"),$("#skip_solventpos").show().button()):"struct_sheet_order+struct_sheet+pdbx_struct_sheet_hbond+struct_sheet_range"==t||"struct_conf+struct_conf_type"==t?($("#skip_link").hide(),$("#skip_site").hide(),$("#skip_solventpos").hide(),checkSkipCalc("helix"),checkSkipCalc("sheet"),$(".skip_scndry_strctr").show().button()):$("#skip_btns_grp").hide())}function initUIcifCtgry(t){$("."+t+"_row_action.onrowselect").hide(),$("#unselect_"+t).hide(),$("#select_for_action_"+t).show()}function initBookKeepingCifCtgry(t){EditorMod.debugCurrentCtgryNm=t,EditorMod.currentCtgryNms.push(t),EditorMod.CtgryConfig[t].checkingMndtryItems=!1,EditorMod.CtgryConfig[t].checkingDictViolations=!1,void 0===EditorMod.currentMndtryViolations[t]&&(EditorMod.currentMndtryViolations[t]=[]),void 0===EditorMod.currentDictViolations[t]&&(EditorMod.currentDictViolations[t]=[]),void 0!==oCARDINALITY_DICT[t]&&"unit"==oCARDINALITY_DICT[t]?EditorMod.CtgryConfig[t].unitCrdnlty=!0:EditorMod.CtgryConfig[t].unitCrdnlty=!1}function redrawTable(t,o){var i=!(o=void 0===o||o);$("#"+t+"_tbl").DataTable().draw(i)}function getSortFlag(t){return 0<=["citation_author","audit_author","em_author_list","entity","entity_poly","struct_ncs_ens","pdbx_refine_tls_group"].indexOf(t)}function getDisplayLength(t){return"citation_author"==t||"audit_author"==t?25:EditorMod.iSrchHeadersThrshld}function getTrueColIdx_DataTable(t,o){var i=t.getColDisplOrder(),e=t.getCtgryName();return 0==EditorMod.CtgryConfig[e].iCnt_DrawBackCalledOnCurrentTbl?o:i[o]}function getTrueRowIdx_DataTable(t,o){var i=$(t).parent().attr("id");return i?i.split("_")[1]:o}function applySearchHeaderFunctions(t,o,i){$("#"+t+" thead input").keyup(function(){i.fnFilter(this.value,getTrueColIdx_DataTable(EditorMod.CtgryConfig[o],$("#"+t+" thead input").index(this)))}),$("#"+t+" thead input").each(function(t){this.initVal=this.value}),$("#"+t+" thead input").focus(function(){"search_init"==this.className&&(this.className="",this.value="")}),$("#"+t+" thead input").blur(function(t){""==this.value&&(this.className="search_init",this.value=this.initVal)})}function applyReadOnlyProtection(t,o,i,e){(0<=EditorMod.CtgryConfig[t].getReadOnlyColumns().indexOf(parseInt(i))||ctgryIsReadOnly(t)||e)&&o.addClass("immutable")}function applyMandatoryHighlight(t,o,i){0<=EditorMod.CtgryConfig[t].getMandatoryColumns().indexOf(parseInt(i))&&o.addClass("mndtry")}function applyNewRecordAttrib(t,o,i,e){if(1==EditorMod.CtgryConfig[t].bAddingNewRow)for(var r=0;r<EditorMod.CtgryConfig[t].addedRowIds.length;r++)Number(i)==Number(EditorMod.CtgryConfig[t].addedRowIds[r])&&(e||o.addClass("newrecord").removeClass("immutable"),e&&-1<EditorMod.CtgryConfig[t].getPrimaryKey().indexOf(parseInt(i))&&o.addClass("newrecord").removeClass("immutable"))}function updateAddedRowIndices(t,o,i,e){if(e=void 0!==e?Number(e):1,"delRow"!=i){if(1==EditorMod.CtgryConfig[t].bAddingNewRow)for(var r=0;r<EditorMod.CtgryConfig[t].addedRowIds.length;r++)Number(EditorMod.CtgryConfig[t].addedRowIds[r])>=Number(o)&&(EditorMod.CtgryConfig[t].addedRowIds[r]=Number(EditorMod.CtgryConfig[t].addedRowIds[r])+Number(e))}else if("delRow"==i){for(var n,d=0;d<e;d++){n=Number(o)+d;for(r=0;r<EditorMod.CtgryConfig[t].addedRowIds.length;r++)if(Number(EditorMod.CtgryConfig[t].addedRowIds[r])==Number(n)){EditorMod.CtgryConfig[t].addedRowIds.splice(r,1);break}}for(r=0;r<EditorMod.CtgryConfig[t].addedRowIds.length;r++){var a=Number(o)+Number(e);Number(EditorMod.CtgryConfig[t].addedRowIds[r])>=Number(a)&&(EditorMod.CtgryConfig[t].addedRowIds[r]=Number(EditorMod.CtgryConfig[t].addedRowIds[r])-Number(e))}}}function getCrrntCtgryNames(){for(var t="",o="",i=0;i<EditorMod.currentCtgryNms.length;i++)0<i&&(t=" and "),o+=t+"'"+EditorMod.currentCtgryNms[i]+"'";return o}function showUndoBtns(t){$("#undobtns_grp").show(),$(".undobtns_"+t+" .undo").show("slow").button()}function undoEdits(t,o){"total"==o?confirm('You have indicated you want to undo all edits since most recent loading of "'+t+'" category onto the screen, yes?')?submitUndo(t,o):alert("Undo cancelled"):submitUndo(t,o)}function submitUndo(e,t){var i=EditorMod.CtgryConfig[e].editLog.length;if(0<i){if("incremental"==t){var r=EditorMod.CtgryConfig[e].editLog.pop();return EditorMod.editActnIndx-=1,$("#hlprfrm").ajaxSubmit({url:EditorMod.URL.UNDO_CHANGES,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:e}),t.push({name:"rewind_idx",value:r.rewind_idx})},success:function(t){if("OK"==t.status){if("edit"==r.type);else if("addrow"==r.type||"delrow"==r.type||"insert"==r.type){if("addrow"==r.type||"insert"==r.type){EditorMod.CtgryConfig[e].addedRows-=r.num_rows;for(var o=EditorMod.addRowActns.length-1;0<=o;o--)if(e==EditorMod.addRowActns[o].ctgryname&&r.rewind_idx==EditorMod.addRowActns[o].idx){EditorMod.addRowActns.splice(o,1),EditorMod.CtgryConfig[e].addedRowIds=r.addrow_rollback.slice();break}}else{EditorMod.CtgryConfig[e].deletedRows-=r.num_rows;for(o=EditorMod.deleteRowActns.length-1;0<=o;o--)if(e==EditorMod.deleteRowActns[o].ctgryname&&r.rewind_idx==EditorMod.deleteRowActns[o].idx){EditorMod.deleteRowActns.splice(o,1),EditorMod.CtgryConfig[e].addedRowIds=r.addrow_rollback.slice();break}}adjustDataBalance(e,"undo")}0==EditorMod.CtgryConfig[e].editLog.length&&$(".undobtns_"+e+" .undo").hide("slow"),EditorMod.CtgryConfig[e].checkingMndtryItems=!0,EditorMod.CtgryConfig[e].checkingDictViolations=!0,updtDictViolationFlags(e),updtMndtryViolationFlags(e)}}}),!1}if("total"==t){var n=EditorMod.CtgryConfig[e].editLog[0].rewind_idx;return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.UNDO_CHANGES,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:e}),t.push({name:"rewind_idx",value:n})},success:function(t){if("OK"==t.status){EditorMod.editActnIndx=EditorMod.editActnIndx-i,EditorMod.CtgryConfig[e].editLog.length=0,EditorMod.CtgryConfig[e].addedRowIds.length=0;for(var o=EditorMod.CtgryConfig[e].deletedRows=0;o<EditorMod.deleteRowActns.length;o++)e==EditorMod.deleteRowActns[o].ctgryname&&EditorMod.deleteRowActns.splice(o,1);for(o=EditorMod.CtgryConfig[e].addedRows=0;o<EditorMod.addRowActns.length;o++)e==EditorMod.addRowActns[o].ctgryname&&EditorMod.addRowActns.splice(o,1);adjustDataBalance(e,"undo"),$(".undobtns_"+e+" .undo").hide("slow"),updtDictViolationFlags(e),updtMndtryViolationFlags(e)}}}),!1}}}function propagateTitle(e){return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.DTBL_PROPAGATE_TITLE,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:e}),t.push({name:"edit_actn_indx",value:EditorMod.editActnIndx})},success:function(t){"OK"==t.status&&(origValue=t.orig_value,EditorMod.CtgryConfig[e].editLog||(EditorMod.CtgryConfig[e].editLog=[]),EditorMod.CtgryConfig[e].editLog.push({type:"edit",rewind_idx:EditorMod.editActnIndx,rowidx:0,colidx:EditorMod.CtgryConfig[e].getColIdxForItemName("title"),origvalue:origValue}),EditorMod.editActnIndx+=1,showUndoBtns(e),redrawTable(e))}}),!1}function handleRowSelectForAction(t,o){var i=t.parents("div.dataTables_wrapper").attr("id").split("_tbl_wrapper")[0],e=t.parents(".atomic_dt_container").attr("id"),r=t.attr("id");$("#"+e+" table.DTFC_Cloned #"+r).hasClass("row_selected")||$("#"+e+" #"+i+"_tbl #"+r).hasClass("row_selected")?($("#"+e+" table.DTFC_Cloned #"+r).removeClass("row_selected"),$("#"+e+" #"+i+"_tbl #"+r).removeClass("row_selected"),$("."+i+"_row_action.onrowselect").hide(),$("#"+e+" .help.unselect").hide(),$("#"+e+" .help.select_for_action").show(),EditorMod.currentRowSlctd=""):($("#"+e+" tbody tr.row_selected").removeClass("row_selected"),$("#"+e+" table.DTFC_Cloned #"+r).addClass("row_selected"),$("#"+e+" #"+i+"_tbl #"+r).addClass("row_selected"),$("#"+i+"_delete_row").show(),$("#"+i+"_insert_row").show(),doesCrrntCtgryHave3DCntxt(i)&&$("#"+i+"_jmol_view").show(),$("#"+e+" .help.unselect").show(),$("#"+e+" .help.select_for_action").hide(),EditorMod.currentRowSlctd=r,EditorMod.currentRowSlctd_CtgryNm=i,(!EditorMod.CtgryConfig[i].unitCrdnlty&&EditorMod.bUseContextMenu||"editorconfig"==EditorMod.context)&&($("#context_menu").show(),$("#context_menu").position({my:"left-2 top-2",of:o}),$(document).on("click",function(t){$(t.target).closest("#context_menu").length||$("#context_menu").hide()}))),EditorMod.currentRowSlctd_TrNode=$("#"+e+" #"+i+"_tbl #"+r)[0]}function deleteRows(e,r,n){n=Number(n);var o=r.split("_")[1];if(0==o&&!(0<=EditorMod.arrAllowLastRowDeleteCtgries.indexOf(e))){var t=EditorMod.CtgryConfig[e].addedRows-EditorMod.CtgryConfig[e].deletedRows;if((t<0?t:0)-n<=-EditorMod.CtgryConfig[e].originalTotalRows)return alert("Cannot delete only remaining record in the category."),$("."+e+"_row_action.onrowselect").hide(),!1}return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.DTBL_ACT_ON_ROW,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:e}),t.push({name:"action",value:"delrow"}),t.push({name:"row_idx",value:r}),t.push({name:"num_rows",value:n}),t.push({name:"edit_actn_indx",value:EditorMod.editActnIndx})},success:function(t){"OK"==t.status?(EditorMod.CtgryConfig[e].editLog||(EditorMod.CtgryConfig[e].editLog=[]),EditorMod.CtgryConfig[e].editLog.push({type:"delrow",rowidx:r,rewind_idx:EditorMod.editActnIndx,addrow_rollback:EditorMod.CtgryConfig[e].addedRowIds.slice(),num_rows:n}),$("."+e+"_row_action.onrowselect").hide(),EditorMod.CtgryConfig[e].deletedRows+=n,updateAddedRowIndices(e,o,"delRow",n),EditorMod.deleteRowActns.push({idx:EditorMod.editActnIndx,ctgryname:e}),adjustDataBalance(e,"edit"),EditorMod.editActnIndx+=1,showUndoBtns(e),"editorconfig"!=EditorMod.context&&updateViolationFlagging(e),$("#unselect_"+e).hide(),$("#select_for_action_"+e).show(),$("#"+e+"_jmol_view").hide()):"ERROR"==t.status&&alert(t.err_msg)}}),!1}function insertRows(r,n,e,d){return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.DTBL_ACT_ON_ROW,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:r}),t.push({name:"action",value:"insert"}),t.push({name:"row_idx",value:n}),t.push({name:"num_rows",value:d}),t.push({name:"edit_actn_indx",value:EditorMod.editActnIndx}),t.push({name:"clone_items",value:e.join(":")})},success:function(t){if("OK"==t.status){EditorMod.CtgryConfig[r].editLog||(EditorMod.CtgryConfig[r].editLog=[]),EditorMod.CtgryConfig[r].editLog.push({type:"insert",rowidx:n,rewind_idx:EditorMod.editActnIndx,addrow_rollback:EditorMod.CtgryConfig[r].addedRowIds.slice(),num_rows:d}),$("."+r+"_row_action.onrowselect").hide(),EditorMod.CtgryConfig[r].addedRows+=Number(d);var o=n.split("_")[1];EditorMod.CtgryConfig[r].bAddingNewRow=!0;var i=Number(o)+1;updateAddedRowIndices(r,i,"insertRow",d);for(var e=0;e<d;e++)EditorMod.CtgryConfig[r].addedRowIds.push(Number(i)+Number(e));EditorMod.addRowActns.push({idx:EditorMod.editActnIndx,ctgryname:r}),EditorMod.editActnIndx+=1,showUndoBtns(r),"editorconfig"!=EditorMod.context&&updateViolationFlagging(r),$("#unselect_"+r).hide(),$("#select_for_action_"+r).show(),$("#"+r+"_jmol_view").hide()}else"ERROR"==t.status&&alert(t.err_msg)}}),!1}function addNewRow(e){return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.DTBL_ACT_ON_ROW,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:e}),t.push({name:"action",value:"addrow"}),t.push({name:"edit_actn_indx",value:EditorMod.editActnIndx})},success:function(t){if("OK"==t.status){EditorMod.CtgryConfig[e].editLog||(EditorMod.CtgryConfig[e].editLog=[]),EditorMod.CtgryConfig[e].editLog.push({type:"addrow",rewind_idx:EditorMod.editActnIndx,addrow_rollback:EditorMod.CtgryConfig[e].addedRowIds.slice(),num_rows:1}),EditorMod.CtgryConfig[e].addedRows+=1;var o=Number(EditorMod.CtgryConfig[e].addingRowHwm)+Number(EditorMod.CtgryConfig[e].addedRowIds.length);EditorMod.CtgryConfig[e].bAddingNewRow=!0,updateAddedRowIndices(e,o,"addRow",1),EditorMod.CtgryConfig[e].addedRowIds.push(o),EditorMod.addRowActns.push({idx:EditorMod.editActnIndx,ctgryname:e}),EditorMod.editActnIndx+=1,showUndoBtns(e),redrawTable(e),$("#"+e+"_tbl").dataTable().fnPageChange("last")}}}),!1}function createInitRollbackPoint(){return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.INIT_ROLLBACK_POINT,clearForm:!1,success:function(t){t.status}}),!1}function skipCalc(e){return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.SKIP_CALC,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"task",value:e})},success:function(t){if("OK"==t.status){var o="";"link"==e?o="Link":"site"==e?o="Site":"helix"==e?o="Helix":"sheet"==e?o="Sheet":"solventpos"==e&&(o="Solvent Reposition"),$("#skip_"+e).val("Undo Skip "+o+" Calc")}}}),!1}function undoSkipCalc(e){return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.SKIP_CALC_UNDO,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"task",value:e})},success:function(t){if("OK"==t.status){var o="";"link"==e?o="Link":"site"==e?o="Site":"helix"==e?o="Helix":"sheet"==e?o="Sheet":"solventpos"==e&&(o="Solvent Reposition"),$("#skip_"+e).val("Skip "+o+" Calc")}}}),!1}function checkSkipCalc(e){return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.CHECK_SKIP_CALC,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"task",value:e})},success:function(t){var o="";"link"==e?o="Link":"site"==e?o="Site":"helix"==e?o="Helix":"sheet"==e?o="Sheet":"solventpos"==e&&(o="Solvent Reposition"),"y"==t.status?$("#skip_"+e).val("Undo Skip "+o+" Calc"):"n"==t.status&&$("#skip_"+e).val("Skip "+o+" Calc")}}),!1}function adjustDataBalance(t,o){var i=Number(EditorMod.CtgryConfig[t].addedRows)-Number(EditorMod.CtgryConfig[t].deletedRows);i<0&&(EditorMod.CtgryConfig[t].addingRowHwm=EditorMod.CtgryConfig[t].originalTotalRows+i),"undo"==o&&0<=i&&(EditorMod.CtgryConfig[t].addingRowHwm=EditorMod.CtgryConfig[t].originalTotalRows)}function showCheckViolButtons(){for(var t in $("input.check_dict_violations.individual").hide(),EditorMod.currentDictViolations)0<EditorMod.currentDictViolations[t].length&&($(".chck_dict_vltns_"+t).html('<input id="check_dict_violations-'+t+'" name="check_dict_violations-'+t+'" value="Check Dictionary Violations" class="fltlft check_dict_violations individual" type="button" style="margin-top: 8px; margin-right: 20px; font-size: .8em;" />'),$("#check_dict_violations-"+t).button())}function updateViolationFlagging(t){EditorMod.CtgryConfig[t].checkingDictViolations=!0,updtDictViolationFlags(t),EditorMod.CtgryConfig[t].checkingMndtryItems=!0,updtMndtryViolationFlags(t)}function sortViolationsDisplayList(t){var o=$("#"+t+" li").get();o.sort(function(t,o){var i=$(t).text(),e=$(o).text();return i<e?-1:e<i?1:0});var i=$("#"+t);$.each(o,function(t,o){i.append(o)})}function processDictViolations(t){var o=[];for(var i in t)if(void 0!==i){for(var e in t[i]);void 0!==t[i].data_positions&&0<t[i].data_positions.length&&(o.push(i),EditorMod.currentDictViolations[i]=t[i].data_positions,void 0===EditorMod.currentDictViolations[i].violtn_msgs&&(EditorMod.currentDictViolations[i].violtn_msgs=new Array),EditorMod.currentDictViolations[i].violtn_msgs=t[i].violation_msgs)}if(0==o.length)alert("No violations of the mmCIF dictionary found.");else{for(var r='<ul id="violtnlist">',n=0;n<o.length;n++){var d="";void 0!==t[i=o[n]].top_menu_label&&0<t[i].top_menu_label.length&&(d=t[i].top_menu_label),r+="<li>"+d+" --\x3e "+i+"</li>"}$("#dict_violation_rslts").html("<p>Please check the following for violations of dictionary constraints:</p>"+r+"</ul>"),sortViolationsDisplayList("violtnlist"),$("#dict_violation_rslts").dialog({width:380,height:350,position:{my:"center top",at:"center top+15%",of:window}}),$("div.ui-dialog").css("z-index","150")}}function checkForDictViolations(cifCtgry,mode){return"all"==cifCtgry&&($("#progressbar").progressbar({value:!1}),$("#validationprogress").show()),$("#hlprfrm").ajaxSubmit({url:EditorMod.URL.CHECK_DICT_VIOLATIONS,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:cifCtgry})},success:function(jsonObj){var violationsMap=new Object;if("all"==cifCtgry)violationsMap=eval("jsonObj.violation_map"),processDictViolations(violationsMap);else{violationsMap=eval("jsonObj.violation_map");var bCtgryHasViolations=!1;for(var ctgryName in violationsMap)if(ctgryName==cifCtgry){var curDataPositions=eval("jsonObj.violation_map."+cifCtgry+".data_positions"),curVioltnMsgs=eval("jsonObj.violation_map."+cifCtgry+".violation_msgs");if(0==curDataPositions.length)"manual"==mode&&alert("No violations of the mmCIF dictionary found for this CIF category."),EditorMod.currentDictViolations[cifCtgry]=curDataPositions;else{bCtgryHasViolations=!0;var oDTable=$("#"+cifCtgry+"_tbl").dataTable(),bTranspose=oDTable.fnTransposeState();if("manual"==mode){for(var list="\n",curColNames=eval("jsonObj.violation_map."+cifCtgry+".col_names"),n=0;n<curColNames.length;n++)list+=curColNames[n]+"\n";alert("Some records are in violation of mmCIF dictionary constraints for the following required fields:\n"+list)}var sSuffix="_tbl";bTranspose&&(sSuffix="_tbl_transpose"),EditorMod.currentDictViolations[cifCtgry]=curDataPositions,EditorMod.currentDictViolations[cifCtgry].violtn_msgs=curVioltnMsgs;for(var i=0;i<EditorMod.currentDictViolations[cifCtgry].length;i++)$("#"+cifCtgry+sSuffix).find('td[true_row_idx="'+EditorMod.currentDictViolations[cifCtgry][i][0]+'"][true_col_idx="'+EditorMod.currentDictViolations[cifCtgry][i][1]+'"]').addClass("dict_violation"),void 0!==EditorMod.currentDictViolations[cifCtgry].violtn_msgs&&$("#"+cifCtgry+sSuffix).find('td[true_row_idx="'+EditorMod.currentDictViolations[cifCtgry][i][0]+'"][true_col_idx="'+EditorMod.currentDictViolations[cifCtgry][i][1]+'"]').prop("title",EditorMod.currentDictViolations[cifCtgry].violtn_msgs[i])}}bCtgryHasViolations||("manual"==mode&&alert("No violations of the mmCIF dictionary found for this CIF category."),EditorMod.currentDictViolations[cifCtgry]=[])}"all"==cifCtgry&&($("progressbar").progressbar("destroy"),$("#validationprogress").hide()),showCheckViolButtons()}}),!1}function processMissingMandatoryItems(t){var o=[];for(var i in t)if(void 0!==i){for(var e in t[i]);void 0!==t[i].data_positions&&0<t[i].data_positions.length&&(o.push(i),EditorMod.currentMndtryViolations[i]=t[i].data_positions)}if(0==o.length)alert("All required items have been populated.");else{for(var r='<ul id="missinglist">',n=0;n<o.length;n++){var d="";void 0!==t[i=o[n]].top_menu_label&&0<t[i].top_menu_label.length&&(d=t[i].top_menu_label),r+="<li>"+d+" --\x3e "+i+"</li>"}$("#mndtry_check_rslts").html("<p>Please check the following for absence of required fields:</p>"+r+"</ul>"),sortViolationsDisplayList("missinglist"),$("#mndtry_check_rslts").dialog({width:460,height:350,position:{my:"center top",at:"center+5% top+15%",of:window}}),$("div.ui-dialog").css("z-index","150")}}function checkForMandatoryItems(cifCtgry,mode){return"all"==cifCtgry&&($("#progressbar").progressbar({value:!1}),$("#validationprogress").show()),$("#hlprfrm").ajaxSubmit({url:EditorMod.URL.CHECK_MANDATORY_ITEMS,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:cifCtgry})},success:function(jsonObj){var violationsMap=new Object;if("all"==cifCtgry)violationsMap=eval("jsonObj.violation_map"),processMissingMandatoryItems(violationsMap);else{violationsMap=eval("jsonObj.violation_map");var bCtgryHasViolations=!1;for(var ctgryName in violationsMap)if(ctgryName==cifCtgry){var curDataPositions=eval("jsonObj.violation_map."+cifCtgry+".data_positions");if(0==curDataPositions.length)"manual"==mode&&alert("All required items have been populated for this CIF category."),EditorMod.currentMndtryViolations[cifCtgry]=curDataPositions;else{bCtgryHasViolations=!0;var oDTable=$("#"+cifCtgry+"_tbl").dataTable(),bTranspose=oDTable.fnTransposeState();if("manual"==mode){for(var list="\n",curColNames=eval("jsonObj.violation_map."+cifCtgry+".col_names"),n=0;n<curColNames.length;n++)list+=curColNames[n]+"\n";alert("Some records are missing data for the following required fields:\n"+list)}var sSuffix="_tbl";bTranspose&&(sSuffix="_tbl_transpose"),EditorMod.currentMndtryViolations[cifCtgry]=curDataPositions;for(var i=0;i<EditorMod.currentMndtryViolations[cifCtgry].length;i++)$("#"+cifCtgry+sSuffix).find('td[true_row_idx="'+EditorMod.currentMndtryViolations[cifCtgry][i][0]+'"][true_col_idx="'+EditorMod.currentMndtryViolations[cifCtgry][i][1]+'"]').addClass("mndtry_missing")}}bCtgryHasViolations||("manual"==mode&&alert("All required items have been populated for this CIF category."),EditorMod.currentMndtryViolations[cifCtgry]=[])}"all"==cifCtgry&&($("progressbar").progressbar("destroy"),$("#validationprogress").hide(),$("ul.nav li.topnav a.chosen").trigger("click")),redrawTable(cifCtgry)}}),!1}function updtMndtryViolationFlags(t){var o="_tbl";$("#"+t+"_tbl").dataTable().fnTransposeState()&&(o="_tbl_transpose"),1==EditorMod.CtgryConfig[t].checkingMndtryItems&&($("#"+t+o+" .mndtry_missing").removeClass(".mdntry_missing"),checkForMandatoryItems(t,"auto"))}function updtDictViolationFlags(t){var o="_tbl";$("#"+t+"_tbl").dataTable().fnTransposeState()&&(o="_tbl_transpose"),1==EditorMod.CtgryConfig[t].checkingDictViolations&&($("#"+t+o+" .dict_violation").removeClass("dict_violation"),checkForDictViolations(t,"auto"))}function showHiddenCols(t){for(var o=EditorMod.CtgryConfig[t].getNumCols(),i=$("#"+t+"_tbl").dataTable(),e=0;e<o;e++)i.fnSettings().aoColumns[e].bVisible||i.fnSetColumnVis(e,!0)}function showJustPriorityCols(t){for(var o=EditorMod.CtgryConfig[t].getPriorityColumns(),i=EditorMod.CtgryConfig[t].getNumCols(),e=$("#"+t+"_tbl").dataTable(),r=o.length;r<i;r++)e.fnSetColumnVis(r,!1);e.fnDraw()}function toggleTransposeAllBtn(){1<EditorMod.currentCtgryNms.length?$("#transpose_vw_all").show().val("Transpose View (All)"):$("#transpose_vw_all").hide()}function updateChosenHighlight(t){$(".cifctgry_submit").removeClass("chosen"),$(".multi_cifctgry_submit").removeClass("chosen"),$("li.topnav a").removeClass("chosen"),t.addClass("chosen"),t.parents("li.topnav").find("a:first").addClass("chosen")}function getTrueColIdx_jEditable(t){return $(t).hasClass("trnspsd")?t.getAttribute("true_row_idx"):t.getAttribute("true_col_idx")}function handleCifNull(t,o){return"?"==t||"."==t?"":t}function applyJeditable(u,d){var g={cifname:u,name:"new_value",event:"click",placeholder:"Click to edit",type:"text",onblur:"submit",logeditfxn:logEdit,submitdata:function(t,o){return{sessionid:SESSION_ID,datafile:DATAFILE,cifctgry:u,row_idx:this.getAttribute("true_row_idx"),col_idx:this.getAttribute("true_col_idx"),filesource:FILE_SOURCE,edit_actn_indx:EditorMod.editActnIndx}},onsubmit:function(t,o){var e,i="",r="",n="",d=o.getAttribute("true_col_idx"),a=o.getAttribute("true_row_idx"),s=EditorMod.CtgryConfig[u].getInputType(d);if(-1!=s.indexOf("select"))0==(e=$(o).find("select").val()).length&&($(o).find("select").val("?"),e="?");else{var l=!1;"textarea"==s?(e=$(o).find("textarea").val(),l=!0):e=$(o).find("input").val(),0==e.length&&(e="?",l?$(o).find("textarea").val(e):$(o).find("input").val(e))}var c=o.revert;return e==c?(o.reset(),!1):(0==e.length?e="?":("citation_author"==u&&2==d||"audit_author"==u&&1==d||"em_author_list"==u&&1==d)&&(EditorMod.gotoRow=e),t.logeditfxn(t.cifname,o,c),"?"==e||"."==e||"editorconfig"==EditorMod.context||void $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.DTBL_VALIDATE_EDIT,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:u}),t.push({name:"row_idx",value:a}),t.push({name:"col_idx",value:d}),t.push({name:"new_value",value:e}),t.push({name:"datafile",value:DATAFILE})},success:function(t){"false"!=t.pass_regex_tst&&"false"!=t.pass_bndry_tst||("false"==t.pass_regex_tst&&(i=t.fail_msg_regex,sRegexFailType=t.fail_typ_regex),"true"==t.pass_regex_tst&&"false"==t.pass_bndry_tst&&(r=t.fail_msg_bndry,n=t.fail_typ_bndry),"soft"==n||"soft"==sRegexFailType?confirm("Warning: "+i+r+"\nClick 'OK' to proceed with submitted value or 'Cancel' to abort.")||undoEdits(u,"incremental"):(alert(i+r),undoEdits(u,"incremental")))},error:function(){alert("Problem on request to validate the new value being submitted.")}}))},callback:function(t,o){if(showUndoBtns(u),EditorMod.editActnIndx+=1,1==EditorMod.dictViolationsTooltip&&$("td.dict_violation").tooltip("destroy"),EditorMod.CtgryConfig[u].checkingMndtryItems=!0,updtMndtryViolationFlags(u),0<EditorMod.gotoRow){var i=d.fnSettings().fnRecordsDisplay(),e=d.fnSettings()._iDisplayLength,r=Math.ceil(i/e);if(1<r)for(var n=0;n<r;n++)if(EditorMod.gotoRow<=(n+1)*e){d.fnPageChange(n);break}EditorMod.gotoRow=-1}},height:"14px",width:"100%"};$("#"+u+"_tbl_wrapper td:not(.immutable):not(.dataTables_empty)").each(function(t){var o,i={type:"textarea",onblur:"submit",rows:4,columns:12,data:handleCifNull},e={type:"select",data:EditorMod.CtgryConfig[u].getSelectOpts(getTrueColIdx_jEditable(this))},r=$.extend({},e,{type:"select_w_other",select_w_other:{id:u+"_"+this.getAttribute("true_col_idx")+"_"+this.getAttribute("true_row_idx")},onsubmit:onSubmitSlctWithOther}),n=$.extend({},e,{type:"multiselect"}),d=$.extend({},e,{type:"multiselect_w_other",select_w_other:{id:u+"_"+this.getAttribute("true_col_idx")+"_"+this.getAttribute("true_row_idx")},onsubmit:onSubmitSlctWithOther}),a={type:"autocomplete",autocomplete:{source:EditorMod.CtgryConfig[u].getAutoCmpltOpts(getTrueColIdx_jEditable(this))},submit:"OK",cancel:"Cancel",onsubmit:onSubmitAutoCmplt,data:handleCifNull},s=$.extend({},a,{type:"autocomplete_w_other",onblur:"ignore",onsubmit:onSubmitAutoCmpltWithOther}),l=$.extend({},a,{type:"multi_autocomplete",onsubmit:onSubmitMultiAutoCmplt,data:handleCifNull}),c=$.extend({},a,{type:"multi_autocomplete_w_other",onsubmit:onSubmitMultiAutoCmpltWthOthr});switch(EditorMod.CtgryConfig[u].getInputType(getTrueColIdx_jEditable(this))){case"checkbox":o=$.extend({},g,{type:"checkbox",name:"",onblur:"",event:"mouseover",submit:"",cancel:"",submitdata:"",onsubmit:"",height:""});break;case"date-time":o=$.extend({},g,{type:"calendar",onblur:"ignore"});break;case"select":o=$.extend({},g,e);break;case"select_w_other":o=$.extend({},g,r);break;case"multiselect":o=$.extend({},g,n);break;case"multiselect_w_other":o=$.extend({},g,d);break;case"autocomplete":o=$.extend({},g,a);break;case"autocomplete_w_other":o=$.extend({},g,s);break;case"multi_autocomplete":o=$.extend({},g,l);break;case"multi_autocomplete_w_other":o=$.extend({},g,c);break;case"textarea":o=$.extend({},g,i);break;default:o=$.extend({data:handleCifNull},g)}$(this).editable(EditorMod.URL.DTBL_SUBMIT_EDIT,o)})}function logEdit(t,o,i){var e=o.getAttribute("true_col_idx"),r=o.getAttribute("true_row_idx");EditorMod.CtgryConfig[t].editLog||(EditorMod.CtgryConfig[t].editLog=[]),EditorMod.CtgryConfig[t].editLog.push({type:"edit",rewind_idx:EditorMod.editActnIndx,rowidx:r,colidx:e,origvalue:i})}function transposeTable(t){var o=$("#"+t+"_tbl").dataTable(),i=o.fnTransposeState();i?$("#transposevw-"+t).val("Transpose View"):$("#transposevw-"+t).val("Default View"),o.fnTranspose(!i),o.fnTransposeState()&&$("#"+t+"_tbl_wrapper input.search_init").parent().hide(),o.fnAdjustColumnSizing(),o.width("100%")}function launchJmol(e,r){var t=EditorMod.oDataTable.fnGetPosition(EditorMod.currentRowSlctd_TrNode),o={};for(var i in EditorMod.oDataTable.fnGetData(t))-1==i.indexOf("DT_")&&(o[i]=EditorMod.oDataTable.fnGetData(t)[i]);var n=JSON.stringify(o);return $("#hlprfrm").ajaxSubmit({url:EditorMod.URL.GET_JMOL_SETUP,clearForm:!1,beforeSubmit:function(t,o,i){t.push({name:"cifctgry",value:e}),t.push({name:"row_idx",value:r}),t.push({name:"row_key_value_json",value:n})},success:function(o){try{$("#jmol_viewer").html(o.htmlmrkup).dialog({width:600,height:600,position:{my:"center top",at:"center top+15%",of:window},close:function(t,o){$(".jmol_view").attr("disabled",!1),$(".cifctgry_add_row").attr("disabled",!1),$(".cifctgry_delete_row").attr("disabled",!1),$(".cifctgry_insert_row").attr("disabled",!1),$("#saveunfinished").attr("disabled",!1),$("#savedone").attr("disabled",!1)}}),$(".jmol_view").attr("disabled",!0),$(".cifctgry_add_row").attr("disabled",!0),$(".cifctgry_delete_row").attr("disabled",!0),$(".cifctgry_insert_row").attr("disabled",!0),$("#saveunfinished").attr("disabled",!0),$("#savedone").attr("disabled",!0)}catch(t){alert("error on launchJmol."),$(".errmsg").html(EditorMod.errStyle+"Error: "+JSON.stringify(o)+"<br />\n"+EditorMod.adminContact).show().delay(3e4).slideUp(800)}}}),!1}function getListOfCategoriesWth3DCntxt(){$("#hlprfrm").ajaxSubmit({url:EditorMod.URL.GET_CATEGORIES_3D_CNTXT,clearForm:!1,success:function(o){try{EditorMod.arrCtgriesWth3Dcntxt=o.categories.split(",")}catch(t){alert("error on getListOfCategoriesWth3DCntxt()."),$(".errmsg").html(EditorMod.errStyle+"Error: "+JSON.stringify(o)+"<br />\n"+EditorMod.adminContact).show().delay(3e4).slideUp(800)}}})}function doesCrrntCtgryHave3DCntxt(t){for(var o=0;o<EditorMod.arrCtgriesWth3Dcntxt.length;o++)if(t==EditorMod.arrCtgriesWth3Dcntxt[o])return!0;return!1}function ctgryIsReadOnly(t){for(var o=0;o<EditorMod.arrReadOnlyCtgries.length;o++)if(t==EditorMod.arrReadOnlyCtgries[o])return!0;return!1}function closeWindow(){"Microsoft Internet Explorer"==navigator.appName?(this.focus(),self.opener=this,self.close()):(window.open("","_parent",""),window.close())}function iframeCloser(){if(window.location!=window.parent.location){var t=null;t=window.parent!=window.top?window.top:window.parent,$.isFunction(t.hideEditFrame)?(console.log("Invoking iframe close method"),t.hideEditFrame()):console.log(">>>WARNING -Can't find iframe destroy method")}}function exitEditor(t){var o,i,e=!1,r=!1,n=FILE_SOURCE.toLowerCase();(n.startsWith("wf")||"archive"==n)&&(e=!0),1<DATAFILE.length&&"upload"!=n&&(r=!0),"done"==t&&(o=EditorMod.URL.EXIT_FINISHED,i=e?">>> Work will be saved and mmCIF editor processing now complete.":">>> Saving. mmCIF file saved with any updates on server."),"abort"==t&&(o=EditorMod.URL.EXIT_ABORT),$("#hlprfrm").ajaxSubmit({url:o,clearForm:!1,success:function(){"editorconfig"!=EditorMod.context&&"abort"!=t&&alert(i),e||r?(iframeCloser(),closeWindow()):"editorconfig"==EditorMod.context?($("#postSaveContent").show(),$("#mainContent").hide()):"abort"!=t?$("html").html('<br /><br /><div><p>You may right-click on this link to download the updated cif file:</p><p><a href="'+SESS_PATH_PREFIX+"/"+DATAFILE+'" >'+DATAFILE+"</a></div>"):$("html").html("")}})}